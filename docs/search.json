[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "modelling",
    "section": "",
    "text": "Introduction\nmodelling is a sub-project of the BioForest project aimed at species related data (correct names, functional traits, phylogeny) as part of the data preparation for data preparation within the project."
  },
  {
    "objectID": "index.html#usage",
    "href": "index.html#usage",
    "title": "modelling",
    "section": "Usage",
    "text": "Usage\nAll modelling analyses rely on the quarto documents (files.qmd) that can be run with R and associated environment defined with renv."
  },
  {
    "objectID": "index.html#project",
    "href": "index.html#project",
    "title": "modelling",
    "section": "Project",
    "text": "Project\nmodelling includes:\n\nAnalyse of the data with associated documentation and figures:\n\nReproductive analyses in files.qmd\nResulting pages in docs/\nDocument structure definition in _quarto.yml\n\nData in data/ with:\n\nAll raw data in raw_data/\nAll derived data in derived_sata/\n\nStan Bayesian models in models/\nR scripts with funtions in r/\nIntermediary files in outputs/\nFigures in figures/\nR environment definition with renv in renv/ and renv/lock\nR files (.Rbuildignore , .Rdata , .Rprofile , .Rhistory, .lintr)\nGit and GitHub files (.gitignore , .github/)\nProject documentation (README.qmd , README.md , NEWS.md, LICENSE )"
  },
  {
    "objectID": "index.html#contribution",
    "href": "index.html#contribution",
    "title": "modelling",
    "section": "Contribution",
    "text": "Contribution\nYou can contribute to the project by forking the repository on github and cloning the fork to your machine using several options, including GitHub desktop GUI. Further informations on contribution are detailed in the online document: https://bioforest-project.github.io/data_preparation/98_contributing.html."
  },
  {
    "objectID": "index.html#help",
    "href": "index.html#help",
    "title": "modelling",
    "section": "Help",
    "text": "Help\nPlease preferentially create an issue on GitHub for any questions, bugs or help needed regarding modelling: https://github.com/Bioforest-project/modelling/issues . You may however reach us by mail with people from the core group (see below)."
  },
  {
    "objectID": "index.html#core-group",
    "href": "index.html#core-group",
    "title": "modelling",
    "section": "Core group",
    "text": "Core group\n\nSylvain Schmitt (sylvain.schmitt@cirad.fr)\nCamille Piponiot-Laroche (camille.piponiot-laroche@cirad.fr)\nBruno HÃ©rault (bruno.herault@cirad.fr)\n\nThe whole group consist of participants to the Bioforest project."
  },
  {
    "objectID": "11_dummy_obs.html",
    "href": "11_dummy_obs.html",
    "title": "Dummy observations",
    "section": "",
    "text": "Code example for data exploration.\n\nWe should add plot infos on disturbance intensity, i.e. lost BA, and treatments (especially controls).\n\n\n\nCode\ndata &lt;- read_csv(\"data/raw_data/aggregated_data.csv\") %&gt;% \n  rename_all(tolower) %&gt;% \n  left_join(read_tsv(\"data/raw_data/environment.tsv\") %&gt;% \n              gather(env, env_value, -site, -plot))\n\n\n\n\nCode\ndata %&gt;%\n  ggplot(aes(year, value, group = paste(site, plot))) +\n  geom_line() +\n  theme_bw() +\n  facet_wrap(~ variable, scales = \"free_y\") +\n  theme(axis.title = element_blank(), \n        strip.text = element_text(size = 6))\n\n\n\n\n\nDummy figure 1 - traj.\n\n\n\n\n\n\nCode\ndata %&gt;%\n  filter(variable == \"agb\", env == \"cwd\") %&gt;% \n  na.omit() %&gt;% \n  ggplot(aes(year, value, group = paste(site, plot), col = env_value)) +\n  geom_line() +\n  theme_bw() +\n  scale_color_viridis_c(\"Climate\\nwater\\ndeficit\\n[ mm ]\") +\n  xlab(\"\") + ylab(expression(\"AGB [\"~Mg~ ha^{-1}~\"]\"))\n\n\n\n\n\nDummy figure 2 - env."
  },
  {
    "objectID": "21_dummy_model.html#classic",
    "href": "21_dummy_model.html#classic",
    "title": "Dummy models",
    "section": "Classic",
    "text": "Classic\n\n\nCode\ndata &lt;- read_csv(\"data/raw_data/aggregated_data.csv\") %&gt;% \n  rename_all(tolower) %&gt;% \n  filter(variable == \"agb\") %&gt;% \n  mutate(site_plot = paste0(site, \"_\", plot)) %&gt;% \n  mutate(site_plot_num = as.numeric(as.factor(site_plot)))\n\n\n\n\nCode\nmdata &lt;- list(\n  N = nrow(data),\n  P = max(data$site_plot_num),\n  y = data$value,\n  year = data$year,\n  plot = data$site_plot_num\n)\nmodel &lt;- cmdstan_model(\"models/dummy.stan\")\nfit &lt;- model$sample(\n  data = mdata,\n  chains = 4, \n  parallel_chains = 4,\n  threads_per_chain = 1,\n  save_warmup = F,\n  max_treedepth = 12\n)\ndir.create(\"data/derived_data/dummy\")\nfit$save_output_files(dir = \"data/derived_data/dummy\")\n\n\n\n\nCode\nfit &lt;- as_cmdstan_fit(list.files(\"data/derived_data/dummy\", full.names = T))\n\n\n\n\nCode\nrhat(fit) %&gt;% \n  mcmc_rhat()\n\n\n\n\n\nRhat\n\n\n\n\n\n\nCode\nfit$draws(c(\"alpha\", \"beta\", \"sigma\", \"sigma_a\", \"sigma_b\")) %&gt;% \n  mcmc_trace()\n\n\n\n\n\nTrace\n\n\n\n\n\n\nCode\nfit$draws(c(\"alpha\", \"beta\", \"sigma\", \"sigma_a\", \"sigma_b\")) %&gt;% \n  mcmc_pairs()\n\n\n\n\n\nPairs\n\n\n\n\n\n\nCode\nfit$summary(c(\"alpha\", \"beta\", \"sigma\", \"sigma_a\", \"sigma_b\")) %&gt;% \n  kable(caption = \"Summary\")\n\n\n\nSummary\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvariable\nmean\nmedian\nsd\nmad\nq5\nq95\nrhat\ness_bulk\ness_tail\n\n\n\n\nalpha\n-34.4175916\n-4.1867950\n48.2046484\n9.1769604\n-133.1686500\n3.5867120\n2.501936\n4.849593\n11.47456\n\n\nbeta\n0.1742818\n0.1618795\n0.0246876\n0.0136688\n0.1497618\n0.2260654\n1.701448\n6.284556\n14.25356\n\n\nsigma\n49.6296399\n49.6211000\n0.9145410\n0.9287748\n48.1783400\n51.1559400\n1.003916\n2716.132701\n2441.89347\n\n\nsigma_a\n2.9157766\n2.1319800\n2.2880955\n2.0967745\n0.6475763\n7.3413580\n2.399378\n4.917238\n29.35076\n\n\nsigma_b\n0.0601926\n0.0599634\n0.0035780\n0.0035326\n0.0547951\n0.0665531\n1.014446\n232.207924\n362.45292\n\n\n\n\n\n\n\nCode\nfit$loo()\n\n\n\nComputed from 4000 by 1569 log-likelihood matrix.\n\n         Estimate   SE\nelpd_loo    763.0  9.7\np_loo        14.8  0.3\nlooic     -1525.9 19.4\n------\nMCSE of elpd_loo is 0.1.\nMCSE and ESS estimates assume MCMC draws (r_eff in [0.3, 1.6]).\n\nAll Pareto k estimates are good (k &lt; 0.7).\nSee help('pareto-k-diagnostic') for details.\n\n\n\n\nCode\nfit$draws(c(\"alpha\", \"beta\", \"sigma\", \"sigma_a\", \"sigma_b\")) %&gt;% \n  mcmc_intervals()\n\n\n\n\n\nIntervals\n\n\n\n\n\n\nCode\npreds &lt;- fit$summary(c(\"mu\"), mean) %&gt;% \n  rename(predicted = mean) %&gt;% \n  mutate(variable = gsub(\"]\", \"\", variable)) %&gt;% \n  separate(variable, c(\"X\", \"site_plot_num\"), sep = \"mu\\\\[\", convert = TRUE) %&gt;% \n  select(-X) %&gt;% \n  left_join(data) %&gt;% \n  rename(observed = value)\nrmse &lt;- sqrt(mean((preds$predicted - preds$observed)^2, na.rm = TRUE))\npreds %&gt;% \n  ggplot(aes(predicted, observed)) +\n  geom_point(alpha = 0.25) +\n  geom_abline(col = \"red\", linetype = \"dashed\") +\n  ggtitle(paste(\"RMSE =\", round(rmse, 2))) +\n  theme_bw()\n\n\n\n\n\nPredicted versus observed.\n\n\n\n\n\n\nCode\npreds %&gt;% \n  filter(site == \"Paracou\", plot == 1) %&gt;% \n  ggplot(aes(year)) +\n  geom_point(aes(y = observed)) +\n  geom_line(aes(y = predicted)) +\n  theme_bw() +\n  theme(axis.title = element_blank())\n\n\n\n\n\nPredicted trajectory"
  },
  {
    "objectID": "21_dummy_model.html#parallel",
    "href": "21_dummy_model.html#parallel",
    "title": "Dummy models",
    "section": "Parallel",
    "text": "Parallel\n\n\nCode\nmdata &lt;- list(\n  N = nrow(data),\n  P = max(data$site_plot_num),\n  y = data$value,\n  year = data$year,\n  plot = data$site_plot_num\n)\nmodel_par &lt;- cmdstan_model(\"models/dummy.stan\", cpp_options = list(stan_threads = TRUE))\nfit_par &lt;- model_par$sample(\n  data = mdata,\n  chains = 4, \n  parallel_chains = 4,\n  threads_per_chain = 5,\n  save_warmup = F,\n  max_treedepth = 12\n)\ndir.create(\"data/derived_data/dummy_par\")\nfit_par$save_output_files(dir = \"data/derived_data/dummy_par\")\n\n\n\n\nCode\nfit_par &lt;- as_cmdstan_fit(list.files(\"data/derived_data/dummy_par\", full.names = T))\n\n\n\n\nCode\nlist(\n  classic = fit$time()$chains,\n  parrallel = fit_par$time()$chains\n) %&gt;% \n  bind_rows(.id = \"model\") %&gt;% \n  ggplot(aes(model, total)) +\n  geom_boxplot() +\n  theme_bw() +\n  xlab(\"Model\") + ylab(\"Total time [ seconds ]\")"
  }
]